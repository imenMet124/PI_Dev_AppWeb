define(["ojs/ojcore","knockout","ojs/ojmodule-element-utils","live-sql/api/worksheet/index","ojs/ojtoolbar","ojs/ojbutton","ojs/ojpopup","live-sql/components/dbt-output-error-item/loader","live-sql/components/loading/loader","./dbt-explain-plan-diagram/loader"],(function(t,i,a,e){return class{constructor(){this._statementText=i.observable(""),this._isReady=i.observable(!1),this._hasError=i.observable(!1),this._error=i.observable(),this._moduleConfig=null,this._explainPlanData=i.observable(),this._plainSQL=i.observable(),this._popUpId="explain-plan-statement-info-"+(new Date).getTime(),this._isLoading=i.observable(!1),this.view=i.observable("diagram"),this.diagramData=i.observable({}),this.sqlQuery=i.observable(""),this._openPlanInTabDisabled=i.pureComputed((()=>0===this._explainPlanData()?.items?.length??"error"===this._explainPlanData()?.items[0].typeData)),this._clear=this._clear.bind(this),this._showStatement=this._showStatement.bind(this),this._openPlanInTab=this._openPlanInTab.bind(this),this._showDiagramView=this._showDiagramView.bind(this),this._showChartView=this._showChartView.bind(this),this._updateGridView=this._updateGridView.bind(this),this._updateDiagramData=this._updateDiagramData.bind(this),this._updateDiagramView=this._updateDiagramView.bind(this),this._updateChartView=this._updateChartView.bind(this),this._onShowAdvancedView=this._onShowAdvancedView.bind(this),this._onShowDiagramView=this._onShowDiagramView.bind(this),this._onShowChartView=this._onShowChartView.bind(this)}_showStatement(){const t=document.getElementById(this._popUpId);t&&(t.isOpen()?t.close():t.open(t.id,{at:{horizontal:"start",vertical:"bottom"},my:{horizontal:"start",vertical:"top"},collision:"none"}))}_openPlanInTab(){const t={data:this._explainPlanData().items,skipOtherXML:!1,statementText:this._explainPlanData().statementText,typeData:"table",typeOutput:"plan",_originalData:JSON.parse(JSON.stringify(this._explainPlanData()))};window.__output={},window.__output.params=t,window.open("?nav=output")}setIsLoading(t){this._isLoading(t)}showResult(t,i){const a="object"==typeof i?i:JSON.parse(i);this._statementText(t),this._isReady(!1),a.error?(this._hasError(!0),this._error(a.error),this._isReady(!0)):(this._hasError(!1),this._explainPlanData(a),"grid"===this.view()?(this._updateGridView(),this._isReady(!0)):"chart"===this.view()?this._updateChartView():this._updateDiagramView())}_clear(){this._statementText(""),this._isReady(!1),this._hasError(!1),this._error(),this._explainPlanData()}_updateGridView(){this._moduleConfig=a.createConfig({viewPath:"src/components/dbt-explain-plan/ExplainPlanGrid.html",viewModelPath:"src/components/dbt-explain-plan/ExplainPlanGrid",params:{data:this._explainPlanData().items}})}_updateDiagramData(){let t=this._statementText().trim();";"===t[t.length-1]&&(t=t.slice(0,-1)),this.sqlQuery(t),e.planTable(t).then((t=>{this.diagramData(t),this._isReady(!0)})).catch((t=>{console.log(t)}))}_updateDiagramView(){this._updateDiagramData()}_updateChartView(){this._updateDiagramData()}_showDiagramView(){this.view("diagram"),this._isReady(!1),this._updateDiagramView()}_showChartView(){this.view("chart"),this._isReady(!1),this._updateChartView()}_onShowAdvancedView(t){setTimeout((()=>{this.view("grid"),this._isReady(!1),this._updateGridView(),this._isReady(!0)}),0)}_onShowDiagramView(t){setTimeout((()=>{this.view("diagram"),this._isReady(!1),this._updateDiagramView(),this._isReady(!0)}),0)}_onShowChartView(t){setTimeout((()=>{this.view("chart"),this._isReady(!1),this._updateChartView(),this._isReady(!0)}),0)}}}));