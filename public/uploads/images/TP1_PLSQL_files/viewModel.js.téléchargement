define(["knockout","ojs/ojcore","ojs/ojcontext","live-sql/components/dbt-code-viewer/loader","ojs/ojknockout","ojs/ojpopup","ojs/ojbutton"],(function(t,e,o){return class{constructor(s){const i=o.getContext(s.element).getBusyContext();this.uniqueId=s.uniqueId,this.busyResolve=i.addBusyState({description:"Web Component Startup - Waiting for data"}),this.composite=s.element,this.properties=s.properties,this.plsqlError=s.properties.plsqlError,this.message=this.properties.message||e.Translations.getTranslatedString("core.modules.worksheet.worksheet_output.script_output.error"),this.lineNumbersId="line-numbers-"+this.uniqueId,this.lineNumbersArray=t.observableArray(),this.popupText=this.properties.popupText,this.codeEditorInstance=document.getElementById(this.properties.targetEditorId)||document.querySelector("dbt-code-editor"),this.controls=[{popupText:this.popupText,popupId:"error-info-popup-"+this.uniqueId,codeEditorLanguage:this.codeEditorInstance.getLanguage().raw}];for(const t of this.controls)t.popupText&&(t.action=()=>{this.showStatement(t.popupId,t.popupText)});this.goToErrorPosition=this.goToErrorPosition.bind(this),this.updateLineNumbers=this.updateLineNumbers.bind(this),this.busyResolve()}showStatement(t){const e=document.getElementById(t);e&&(e.isOpen()?e.close():e.open(e.id,{my:{horizontal:"end",vertical:"bottom"},at:{horizontal:"start",vertical:"top"},collision:"none"}))}goToErrorPosition(t){t.preventDefault();const e=this.codeEditorInstance,o=this.plsqlError.position.split(":"),s=e.getAPIPositionFrom({lineNumber:o[0]||1,column:o[1]||1});e.getElementsByTagName("textarea")[0].focus(),e.setCursorPosition(s)}updateLineNumbers(){const t=this.popupText.split("\n").length;this.lineNumbersArray(Array.from({length:t}))}connected(t){}bindingsApplied(t){this.updateLineNumbers()}disconnected(t){}}}));