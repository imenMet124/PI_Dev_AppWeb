/*!
 Copyright (c) 2012, 2019 Oracle and/or its affiliates. All rights reserved.
*/
apex.util=function(t){"use strict";function e(t){return t?t.replace(/([\.\$\*\+\-\?\(\)\{\}\|\^\[\]\\])/g,"\\$1"):""}function n(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}var r=function(t){return n(t=""+t)},i=r,o=new RegExp("(["+e(" !#$%&'()*+,./:;<=>?@[\\]^`{|}~\"")+"])","g"),l=null,a=null,u=null,s={markup:function(t){return this.html+=t,this},attr:function(t,e){return 1===arguments.length&&(e=t,t=null),t&&(this.html+=" "+t+"='"),this.html+=r(e),t&&(this.html+="'"),this},optionalAttr:function(t,e){return e&&"object"!=typeof e&&(this.html+=" "+t+"='"+r(e)+"'"),this},optionalBoolAttr:function(t,e){return!0===e&&(this.html+=" "+t),this},content:function(t){return this.html+=i(t),this},clear:function(){this.html=""},toString:function(){return this.html}},p={debounce:function(t,e){var n;return function(){var r=arguments,i=this;clearTimeout(n),n=setTimeout((function(){n=null,t.apply(i,r)}),e)}},toArray:function(e,n){var r,i=[];return"string"==typeof e?(r=void 0===n?":":n,i=e.split(r)):i=t.makeArray(e),i},arrayEqual:function(t,e){var n,r=t.length;if(r!==e.length)return!1;for(n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0},escapeHTML:n,escapeRegExp:e,escapeCSS:function(t){return t?t.replace(o,"\\$1"):""},htmlBuilder:function(){var t=Object.create(s);return t.clear(),t},makeApplicationUrl:function(t){var e,n="f?p=";if(n+=t.appId||$v("pFlowId"),n+=":",n+=t.pageId||$v("pFlowStepId"),n+=":",n+=t.session||$v("pInstance"),n+=":",n+=t.request||$v("pRequest"),n+=":",n+=t.debug||$v("pdebug")||"",n+=":",n+=t.clearCache||"",n+=":",t.itemNames&&(n+=t.itemNames.join(",")),n+=":",t.itemValues)for(e=0;e<t.itemValues.length;e++)e>0&&(n+=","),n+=encodeURIComponent(t.itemValues[e]);return n+=":",n+=t.printerFriendly||""},showSpinner:function(e,n){var r,i,o,l,a,u=p.htmlBuilder(),s=t.extend({alert:apex.lang.getMessage("APEX.PROCESSING"),spinnerClass:""},n),c=e&&!s.fixed?t(e):t("body"),d=t(window),f=c.offset(),h={top:d.scrollTop(),left:d.scrollLeft()};return u.markup("<span").attr("class","u-Processing"+(s.spinnerClass?" "+s.spinnerClass:"")).attr("role","alert").markup(">").markup("<span").attr("class","u-Processing-spinner").markup(">").markup("</span>").markup("<span").attr("class","u-VisuallyHidden").markup(">").content(s.alert).markup("</span>").markup("</span>"),(r=t(u.toString())).appendTo(c),s.fixed?(o=(d.height()-r.height())/2,i=(d.width()-r.width())/2,r.css({position:"fixed",top:o+"px",left:i+"px"})):(h.bottom=h.top+d.height(),h.right=h.left+d.width(),f.bottom=f.top+c.outerHeight(),f.right=f.left+c.outerWidth(),o=f.top>h.top?f.top:h.top,l=((f.bottom<h.bottom?f.bottom:h.bottom)-o)/2,(a=h.top-f.top)>0&&(l+=a),r.position({my:"center",at:"left+50% top+"+l+"px",of:c,collision:"fit"})),r},delayLinger:function(){var t={};function e(e){var n=t[e];return n||(n={count:0,timer:null},t[e]=n),n}function n(e){delete t[e]}return{start:function(t,n){var r=e(t);r.count+=1,1!==r.count||null!==r.timer||r.showing||(r.start=(new Date).getTime(),r.timer=setTimeout((function(){r.timer=null,r.showing=!0,n()}),200))},finish:function(t,r){var i,o=e(t);if(0===o.count)throw new Error("delayLinger.finish called before start for scope "+t);i=(new Date).getTime()-o.start,o.count-=1,0===o.count&&(null===o.timer?i<1e3?setTimeout((function(){0===o.count&&(o.showing=!1,r(),n(t))}),1e3-i):(o.showing=!1,r(),n(t)):(clearTimeout(o.timer),o.timer=null,n(t)))}}}(),setOuterHeight:function(e,n){t.each(["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom","marginTop","marginBottom"],(function(t,r){var i=parseInt(e.css(r),10);isNaN(i)||(n-=i)})),e.height(n)},setOuterWidth:function(e,n){t.each(["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight","marginLeft","marginRight"],(function(t,r){var i=parseInt(e.css(r),10);isNaN(i)||(n-=i)})),e.width(n)},getDateFromISO8601String:function(t){var e,n,r,i=0,o=0,l=0,a=0,u=/^(\d\d\d\d)-(\d\d)-(\d\d)(T(\d\d):(\d\d)(:(\d\d)(.(\d\d\d))?)?Z?)?$/.exec(t);if(!u)throw new Error("Invalid date format");return e=parseInt(u[1],10),n=parseInt(u[2],10)-1,r=parseInt(u[3],10),u[5]&&(i=parseInt(u[5],10),o=parseInt(u[6],10),u[8]&&(l=parseInt(u[8],10),u[10]&&(a=parseInt(u[10],10)))),new Date(Date.UTC(e,n,r,i,o,l,a))},getTopApex:function(){var t,e;function n(t){var e;try{e=t.apex||null}catch(t){e=null}return e}if(null!==u)return u;if(null!==(u=n(top)))return u;for(t=window;null!==(e=n(t))&&t.parent&&t.parent!==t;)u=e,t=t.parent;return u},getScrollbarSize:function(){var e;return null===l&&(e=t("<div>").css({width:"100px",height:"100px",overflow:"scroll",position:"absolute",top:"-9999px"}).appendTo("body"),l={width:e[0].offsetWidth-e[0].clientWidth,height:e[0].offsetHeight-e[0].clientHeight},e.remove()),l},invokeAfterPaint:(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return window.setTimeout(t,0)}).bind(window),cancelInvokeAfterPaint:(window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||function(t){return window.clearTimeout(t)}).bind(window),stripHTML:function(t){for(var e=/<[^<>]+>/;e.exec(t);)t=t.replace(e,"");return t},getNestedObject:function(t,e){var n=t;return e.length>0&&e.split(".").forEach((function(t){void 0===n[t]&&(n[t]={}),n=n[t]})),n},applyTemplate:function(e,i){var o,l,u,s,c,d=/^(.+)_LABEL$/,f=/#([_$A-Z0-9]+)#/,h=/&(([A-Z0-9_$#]+)|"([^"&\r\n]+)")(!([A-Z]+))?\./g,g=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script\s*>/gi,m=/\$[^$]*$/,w=apex.model,b=apex.item;function v(t){return t.replace(h,(function(t,e,o,l,u,s){var c,f,h,g,v,T,x,I,A,y,S,P,$=null,E=i.defaultEscapeFilter,R=null;if(l&&(o=l),o){if(0===o.indexOf("APP_TEXT$")&&(S=o.substr(9),(P=m.exec(S))&&(P[0].length>1&&apex.debug.warn("applyTemplate message text substitution "+P[0]+" language ignored."),S=S.replace(m,"")),S&&(R=apex.lang.getMessage(S))),null===R&&i.includePageItems&&(f=b(o)).node&&(R=f.getValue(),R=f.displayValueFor(R)),null===R&&i.model&&i.record){for(h=i.model,g=i.record,x=[];null===R&&g&&h;)R=h.getValue(g,o)||null,g=null,null===R?((A=d.exec(o))&&(y=A[1],(I=h.getOption("fields")).hasOwnProperty(y)&&(R=I[y].label||I[y].heading||null)),null===R&&(v=h.getOption("parentModel"),T=h.getOption("parentRecordId"),v&&T&&(h=w.get(v))&&(x.push(v),g=h.getRecord(T)))):((I=h.getOption("fields"))[o].hasOwnProperty("escape")&&(E=I[o].escape?"HTML":"RAW"),I[o].hasOwnProperty("elementId")&&($=I[o].elementId));for(c=0;c<x.length;c++)w.release(x[c])}if(null===R&&i.includeBuiltinSubstitutions&&(R=a[o]||null),null===R&&i.extraSubstitutions&&(R=i.extraSubstitutions[o]||null),null===R)R="";else if("object"==typeof R&&R.hasOwnProperty("d")?R=R.d:$&&(f=b($)).node&&(R=f.displayValueFor(R)),s||(s=E),"HTML"===s)R=n(R);else if("ATTR"===s)R=r(R);else if("STRIPHTML"===s)R=n(p.stripHTML(R.replace("&nbsp;","")));else if("RAW"!==s&&s)throw new Error("Invalid template filter: "+s)}else R="";return R}))}if(i=t.extend({placeholders:null,defaultEscapeFilter:"HTML",includePageItems:!0,model:null,record:null,extraSubstitutions:null,includeBuiltinSubstitutions:!0},i||{}),!a&&i.includeBuiltinSubstitutions&&(a={APP_ID:$v("pFlowId"),APP_PAGE_ID:$v("pFlowStepId"),APP_SESSION:$v("pInstance"),REQUEST:$v("pRequest"),DEBUG:$v("pdebug"),IMAGE_PREFIX:window.apex_img_dir||""}),i.placeholders){for(o="",u=(l=e).search(f);u>=0;)s=l.match(f)[1],(c=i.placeholders[s])?(o+=v(l.substring(0,u))+c,l=l.substring(u+s.length+2)):(o+=v(l.substring(0,u+s.length+1)),l=l.substring(u+s.length+1)),u=l.search(f);o+=v(l)}else o=v(e);for(;g.test(o);)o=o.replace(g,"");return o}};return p.escapeHTMLContent=i,p.escapeHTMLAttr=r,p}(apex.jQuery);